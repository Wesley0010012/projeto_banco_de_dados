--------------------------------------------
-- SEQUENCIAS
--------------------------------------------
-- SEQUENCIA RELACAO CONVENIADOS
CREATE SEQUENCE "CNV_SEQ" MINVALUE 1 MAXVALUE 999 INCREMENT BY 1 START WITH 1 NOCACHE ORDER NOCYCLE NOKEEP NOSCALE GLOBAL;
-- SEQUENCIA RELACAO CUSTOS ESTACIONAMENTO
CREATE SEQUENCE "CES_SEQ" MINVALUE 1 MAXVALUE 99999 INCREMENT BY 1 START WITH 1 NOCACHE ORDER NOCYCLE NOKEEP NOSCALE GLOBAL;
-- SEQUENCIA RELACAO MENSALISTAS
CREATE SEQUENCE "MNL_SEQ" MINVALUE 1 MAXVALUE 9999 INCREMENT BY 1 START WITH 1 NOCACHE ORDER NOCYCLE NOKEEP NOSCALE GLOBAL;
-- SEQUENCIA RELACAO NOTAS FISCAIS
CREATE SEQUENCE "NTF_SEQ" MINVALUE 1 MAXVALUE 99999 INCREMENT BY 1 START WITH 1 NOCACHE ORDER NOCYCLE NOKEEP NOSCALE GLOBAL;
-- SEQUENCIA RELACAO PAGAMENTOS
CREATE SEQUENCE "PGT_SEQ" MINVALUE 1 MAXVALUE 9999 INCREMENT BY 1 START WITH 1 NOCACHE ORDER NOCYCLE NOKEEP NOSCALE GLOBAL;
-- SEQUENCIA TIPOS VAGAS
CREATE SEQUENCE "TPV_SEQ" MINVALUE 1 MAXVALUE 999 INCREMENTS BY 1 START WITH 1 NOCACHE ORDER NOCYCLE NOKEEP NOSCALE GLOBAL;
-- SEQUENCIA VEICULOS
CREATE SEQUENCE "VCL_SEQ" MINVALUE 1 MAXVALUE 99999 INCREMENTS BY 1 START WITH 1 NOCACHE ORDER NOCYCLE NOKEEP NOSCALE GLOBAL;
--------------------------------------------
-- FIM - SEQUENCIAS
--------------------------------------------
---------------------------------------
-- RELACOES
---------------------------------------
-- RELACAO CONVENIADOS
CREATE TABLE "CONVENIADOS" (
    CNV_ID NUMBER (3),
    CNV_RAZAO_SOCIAL VARCHAR2 (30),
    CNV_CNPJ VARCHAR2 (14)
);
-- RELACAO CUSTOS ESTACIONAMENTO
CREATE TABLE "CUSTOS_ESTACIONAMENTO" (
    CES_ID NUMBER (5),
    CES_PLACA VARCHAR2 (7),
    CES_DATA_HORA_ENTRADA DATE,
    CES_DATA_HORA_SAIDA DATE,
    CES_PRECO NUMBER (5, 2),
    CES_TPV_ID NUMBER (3)
);
-- RELACAO MENSALISTAS
CREATE TABLE "MENSALISTAS" (
    MNL_ID NUMBER (4),
    MNL_NOME VARCHAR2 (30),
    MNL_COD_UNICO VARCHAR2 (32),
    MNL_DATA_INCLUSAO DATE,
    MNL_ATIVO NUMBER
);
-- RELACAO NOTAS FISCAIS
CREATE TABLE "NOTAS_FISCAIS" (
    NTF_ID NUMBER (5),
    NTF_NFE VARCHAR2 (44),
    NTF_DESCONTO_TOTAL NUMBER (5, 2),
    NTF_CES_ID NUMBER (5),
    NTF_CNV_ID NUMBER (3)
);
-- RELACAO PAGAMENTOS
CREATE TABLE "PAGAMENTOS" (
    PGT_ID NUMBER(3),
    PGT_VALOR NUMBER (5, 2),
    pgt_MNL_ID NUMBER (4)
);
-- RELACAO TIPOS VAGAS
CREATE TABLE "TIPOS_VAGAS" (
    TPV_ID NUMBER (3),
    TPV_CATEGORIA VARCHAR2 (30),
    TPV_PRECO NUMBER (3, 2)
);
-- RELACAO VEICULOS
CREATE TABLE "VEICULOS" (
    VCL_ID NUMBER (5),
    VCL_PLACA VARCHAR2 (7),
    VCL_TPV_ID NUMBER (3),
    VCL_MNL_ID NUMBER (4)
) ---------------------------------------
-- FIM - RELACOES
---------------------------------------
----------------------------------------------
-- COMENTARIOS
----------------------------------------------
-- COMENTARIOS - CONVENIADOS
COMMENT ON TABLE CONVENIADOS IS 'RELACAO RESPONSAVEL POR PERSISTIR OS ESTABELECIMENTOS CONVENIADOS AO ESTACIONAMENTO';
COMMENT ON COLUMN CONVENIADOS.CNV_ID IS 'CODIGO IDENTIFICADOR UNICO DOS ESTABELECIMENTOS CONVENIADOS';
COMMENT ON COLUMN CONVENIADOS.CNV_RAZAO_SOCIAL IS 'RAZAO SOCIAL DOS ESTABELECIMENTOS CONVENIADOS';
COMMENT ON COLUMN CONVENIADOS.CNV_CNPJ IS 'CNPJ DOS ESTABELECIMENTOS CONVENIADOS';
-- COMENTARIOS - CUSTOS ESTACIONAMENTO
COMMENT ON TABLE CUSTOS_ESTACIONAMENTO IS 'RELACAO RESPONSAVEL POR PERSISTIR OS CUSTOS GERAIS DOS VEICULOS GERAIS ALOCADOS NO ESTACIONAMENTO';
COMMENT ON COLUMN CUSTOS_ESTACIONAMENTO.CES_ID IS 'CODIGO IDENTIFICADOR UNICO DO CUSTO DE ALOCACAO DE UM VEICULO NO ESTACIONAMENTO';
COMMENT ON COLUMN CUSTOS_ESTACIONAMENTO.CES_PLACA IS 'PLACA DO VEICULO QUE FEZ A ALOCACAO';
COMMENT ON COLUMN CUSTOS_ESTACIONAMENTO.CES_DATA_HORA_ENTRADA IS 'DATA E HORA DE ALOCACAO DO VEICULO NO ESTACIONAMENTO';
COMMENT ON COLUMN CUSTOS_ESTACIONAMENTO.CES_DATA_HORA_SAIDA IS 'DATA E HORA DO FIM DA  ALOCACAO DO VEICULO NO ESTACIONAMENTO';
COMMENT ON COLUMN CUSTOS_ESTACIONAMENTO.CES_PRECO IS 'CUSTO TOTAL DO PERIODO DE ALOCACAO DO VEICULO';
COMMENT ON COLUMN CUSTOS_ESTACIONAMENTO.CES_TPV_ID IS 'CODIGO EXTERNO REFERENCIADOR DO TIPO DE VAGA UTILIZADA PELO VEICULO';
-- COMENTARIOS - MENSALISTAS
COMMENT ON TABLE MENSALISTAS IS 'RELACAO RESPONSAVEL POR PERSISTIR OS CLIENTES MENSALISTAS UTILIZADORES DO ESTACIONAMENTO';
COMMENT ON COLUMN MENSALISTAS.MNL_ID IS 'CODIGO IDENTIFICADOR UNICO DOS CLIENTES MENSALISTAS DO ESTACIONAMENTO';
COMMENT ON COLUMN MENSALISTAS.MNL_NOME IS 'NOME DOS CLIENTE MENSALISTA DO ESTACIONAMENTO';
COMMENT ON COLUMN MENSALISTAS.MNL_COD_UNICO IS 'CODIGO UNICO UTILIZADO PARA ACESSO EXCLUSIVO AS VAGAS DO CLIENTE MENSALISTA';
COMMENT ON COLUMN MENSALISTAS.MNL_DATA_INCLUSAO IS 'DATA DE INCLUSAO DE CADASTRO MENSAL DO CLIENTE NO ESTACIONAMENTO';
COMMENT ON COLUMN MENSALISTAS.MNL_ATIVO IS 'IDENTIFICADOR DE ATIVIDADE DE PAGAMENTO MENSAL DO CLIENTE';
-- COMENTARIOS - NOTAS FISCAIS
COMMENT ON TABLE NOTAS_FISCAIS IS 'RELACAO RESPONSAVEL POR PERSISTIR AS NOTAS FISCAIS DE ESTACIONAMENTO CONVENIADOS ENTREGUES POR CLIENTES GERAIS DO ESTACIONAMENTO PARA AMORTIZAR O PAGAMENTO DO CUSTO DE ESTACIONAMENTO';
COMMENT ON COLUMN NOTAS_FISCAIS.NTF_ID IS 'CODIGO IDENTIFICADOR UNICO DAS NOTAS FISCAIS';
COMMENT ON COLUMN NOTAS_FISCAIS.NTF_NFE IS 'CODIGO IDENTIFICADOR DA NOTA FISCAL GERADA NA IMPRESSAO NO ESTABELECIMENTO';
COMMENT ON COLUMN NOTAS_FISCAIS.NTF_DESCONTO_TOTAL IS 'VALOR DE AMORTIZACAO PROFERIDA PELA NOTA FISCAL';
COMMENT ON COLUMN NOTAS_FISCAIS.NTF_CES_ID IS 'CODIGO EXTERNO REFERENCIADOR DO CUSTO DE ESTACIONAMENTO DO QUAL UTILIZOU DA AMORTIZACAO';
COMMENT ON COLUMN NOTAS_FISCAIS.NTF_CNV_ID IS 'CODIGO EXTERNO DO ESTABELECIMENTO CONVENIADO QUE IMPRIMIU A NOTA FISCAL';
-- COMENTARIOS - PAGAMENTOS
COMMENT ON TABLE PAGAMENTOS IS 'RELACAO RESPONSAVEL POR PERSISTIR OS PAGAMENTOS EXECUTADOS PELOS CLIENTES MENSALISTAS DO ESTACIONAMENTO';
COMMENT ON COLUMN PAGAMENTOS.PGT_ID IS 'CODIGO IDENTIFICADOR UNICO DOS PAGAMENTOS';
COMMENT ON COLUMN PAGAMENTOS.PGT_VALOR IS 'VALOR NUMERICO RESPONSAVEL POR DEFINIR O TOTAL A SER PAGO';
COMMENT ON COLUMN PAGAMENTOS.PGT_MNL_ID IS 'CODIGO IDENTIFICADOR EXTERNO REFERENCIADOR DO CLIENTE MENSALISTA DEVEDOR';
-- COMENTARIOS - TIPOS VAGAS
COMMENT ON TABLE TIPOS_VAGAS IS 'RELACAO RESPONSAVEL POR PERSISTIR OS TIPOS DE VAGAS DISPONIVEIS NO ESTACIONAMENTO';
COMMENT ON COLUMN TIPOS_VAGAS.TPV_ID IS 'CODIGO IDENTIFICADOR UNICO DO TIPO DE VAGA POSSIVEL PARA ALOCACAO NO ESTACIONAMENTO';
COMMENT ON COLUMN TIPOS_VAGAS.TPV_CATEGORIA IS 'CATEGORIA REPRESENTATIVA DO TIPO DE VAGA EXISTENTE NO ESTACIONAMENTO';
COMMENT ON COLUMN TIPOS_VAGAS.TPV_PRECO IS 'CUSTO FIXO DE ALOCACAO DO TIPO DA VAGA';
-- COMENTARIOS - VEICULOS
COMMENT ON TABLE VEICULOS IS 'RELACAO RESPONSAVEL POR PERSISTIR OS VEICULOS UTILIZADOS PELOS CLIENTES MENSALISTAS DO ESTACIONAMENTO';
COMMENT ON COLUMN VEICULOS.VCL_ID IS 'CODIGO IDENTIFICADOR UNICO DOS VEICULOS UTILIZADOS PELOS CLIENTES MENSALISTAS';
COMMENT ON COLUMN VEICULOS.VCL_PLACA IS 'PLACA DOS VEICULOS UTILIZADOS PELOS CLIENTES MENSALISTAS';
COMMENT ON COLUMN VEICULOS.VCL_TPV_ID IS 'CODIGO EXTERNO REFERENCIADOR DO TIPO DE VAGA UTILIZADO PELOS VEICULOS';
COMMENT ON COLUMN VEICULOS.VCL_MNL_ID IS 'CODIGO EXTERNO REFERENCIADOR DO CLIENTE MENSALISTA DONO DO VEICULO';
----------------------------------------------
-- FIM - COMENTARIOS
--------------------------------------------------------------------------------------------
-- RESTRICOES RELACOES
----------------------------------------------
-- RESTRICOES - CONVENIADOS
-- NOT NULL
ALTER TABLE CONVENIADOS
MODIFY (
        "CNV_ID" CONSTRAINT "CK_CNV_NN_01" NOT NULL ENABLE
    );
ALTER TABLE CONVENIADOS
MODIFY (
        "CNV_RAZAO_SOCIAL" CONSTRAINT "CK_CNV_NN_02" NOT NULL ENABLE
    );
ALTER TABLE CONVENIADOS
MODIFY (
        "CNV_CNPJ" CONSTRAINT "CK_CNV_NN_03" NOT NULL ENABLE
    );
-- CHAVE PRIMARIA
ALTER TABLE CONVENIADOS
ADD CONSTRAINT "PK_CNV" PRIMARY KEY ("CNV_ID");
-- RESTRICOES - CUSTOS ESTACIONAMENTO
-- NOT NULL
ALTER TABLE CUSTOS_ESTACIONAMENTO
MODIFY (
        "CES_ID" CONSTRAINT "CK_CES_NN_01" NOT NULL ENABLE
    );
ALTER TABLE CUSTOS_ESTACIONAMENTO
MODIFY (
        "CES_PLACA" CONSTRAINT "CK_CES_NN_02" NOT NULL ENABLE
    );
ALTER TABLE CUSTOS_ESTACIONAMENTO
MODIFY (
        "CES_DATA_HORA_ENTRADA" CONSTRAINT "CK_CES_NN_03" NOT NULL ENABLE
    );
ALTER TABLE CUSTOS_ESTACIONAMENTO
MODIFY (
        "CES_TPV_ID" CONSTRAINT "CK_CES_TPV_NN_04" NOT NULL ENABLE
    );
-- CHAVE PRIMARIA
ALTER TABLE CUSTOS_ESTACIONAMENTO
ADD CONSTRAINT "PK_CES" PRIMARY KEY ("CES_ID");
-- RESTRICOES - MENSALISTAS
-- NOT NULL
ALTER TABLE "MENSALISTAS"
MODIFY (
        "MNL_ID" CONSTRAINT "CK_MNL_NN_01" NOT NULL ENABLE
    );
ALTER TABLE "MENSALISTAS"
MODIFY (
        "MNL_NOME" CONSTRAINT "CK_MNL_NN_02" NOT NULL ENABLE
    );
ALTER TABLE "MENSALISTAS"
MODIFY (
        "MNL_COD_UNICO" CONSTRAINT "CK_MNL_NN_03" NOT NULL ENABLE
    );
ALTER TABLE "MENSALISTAS"
MODIFY (
        "MNL_DATA_INCLUSAO" CONSTRAINT "CK_MNL_NN_04" NOT NULL ENABLE
    );
ALTER TABLE "MENSALISTAS"
MODIFY (
        "MNL_ATIVO" CONSTRAINT "CK_MNL_NN_05" NOT NULL ENABLE
    );
-- CHAVE PRIMARIA
ALTER TABLE "MENSALISTAS"
ADD CONSTRAINT "PK_MNL" PRIMARY KEY ("MNL_ID");
-- RESTRICOES - NOTAS FISCAIS
-- NOT NULL
ALTER TABLE "NOTAS_FISCAIS"
MODIFY (
        "NTF_ID" CONSTRAINT "CK_NTF_NN_01" NOT NULL ENABLE
    );
ALTER TABLE "NOTAS_FISCAIS"
MODIFY (
        "NTF_NFE" CONSTRAINT "CK_NTF_NN_02" NOT NULL ENABLE
    );
ALTER TABLE "NOTAS_FISCAIS"
MODIFY (
        "NTF_DESCONTO_TOTAL" CONSTRAINT "CK_NTF_NN_03" NOT NULL ENABLE
    );
ALTER TABLE "NOTAS_FISCAIS"
MODIFY (
        "NTF_CES_ID" CONSTRAINT "CK_NTF_NN_04" NOT NULL ENABLE
    );
ALTER TABLE "NOTAS_FISCAIS"
MODIFY (
        "NTF_CNV_ID" CONSTRAINT "CK_NTF_NN_05" NOT NULL ENABLE
    );
--CHAVE PRIMARIA
ALTER TABLE "NOTAS_FISCAIS"
ADD CONSTRAINT "PK_NTF" PRIMARY KEY ("NTF_ID");
-- RESTRICOES - PAGAMENTOS
-- NOT NULL
ALTER TABLE "PAGAMENTOS"
MODIFY (
        "PGT_ID" CONSTRAINT "CK_PGT_NN_01" NOT NULL ENABLE
    );
ALTER TABLE "PAGAMENTOS"
MODIFY (
        "PGT_VALOR" CONSTRAINT "CK_PGT_NN_02" NOT NULL ENABLE
    );
ALTER TABLE "PAGAMENTOS"
MODIFY (
        "PGT_MNL_ID" CONSTRAINT "CK_PGT_NN_03" NOT NULL ENABLE
    );
-- CHAVE PRIMARIA
ALTER TABLE "PAGAMENTOS"
ADD CONSTRAINT "PK_PGT" PRIMARY KEY ("PGT_ID");
-- RESTRICOES - TIPOS VAGAS
-- NOT NULL
ALTER TABLE "TIPOS_VAGAS"
MODIFY (
        "TPV_ID" CONSTRAINT "CK_TPV_NN_01" NOT NULL ENABLE
    );
ALTER TABLE "TIPOS_VAGAS"
MODIFY (
        "TPV_CATEGORIA" CONSTRAINT "CK_TPV_NN_02" NOT NULL ENABLE
    );
ALTER TABLE "TIPOS_VAGAS"
MODIFY (
        "TPV_PRECO" CONSTRAINT "CK_TPV_NN_03" NOT NULL ENABLE
    );
-- CHAVE PRIMARIA
ALTER TABLE "TIPOS_VAGAS"
ADD CONSTRAINT "PK_TPV" PRIMARY KEY ("TPV_ID");
-- RESTRICOES - VEICULOS
-- NOT NULL
ALTER TABLE "VEICULOS"
MODIFY (
        "VCL_ID" CONSTRAINT "CK_VCL_NN_01" NOT NULL ENABLE
    );
ALTER TABLE "VEICULOS"
MODIFY (
        "VCL_PLACA" CONSTRAINT "CK_VCL_NN_02" NOT NULL ENABLE
    );
ALTER TABLE "VEICULOS"
MODIFY (
        "VCL_TPV_ID" CONSTRAINT "CK_VCL_NN_03" NOT NULL ENABLE
    );
ALTER TABLE "VEICULOS"
MODIFY (
        "VCL_MNL_ID" CONSTRAINT "CK_VCL_NN_04" NOT NULL ENABLE
    );
-- CHAVE PRIMARIA
ALTER TABLE "VEICULOS"
ADD CONSTRAINT "PK_VCL" PRIMARY KEY ("VCL_ID");
----------------------------------------------
-- RESTRICOES DE CHAVES ESTRANGEIRAS
----------------------------------------------
ALTER TABLE "CUSTOS_ESTACIONAMENTO"
ADD CONSTRAINT "FK_CES_TPV" FOREIGN KEY ("CES_TPV_ID") REFERENCES "TIPOS_VAGAS" ("TPV_ID") ENABLE;
ALTER TABLE "NOTAS_FISCAIS"
ADD CONSTRAINT "FK_NTF_CES" FOREIGN KEY ("NTF_CES_ID") REFERENCES "CUSTOS_ESTACIONAMENTO" ("CES_ID") ENABLE;
ALTER TABLE "NOTAS_FISCAIS"
ADD CONSTRAINT "FK_NTF_CNV" FOREIGN KEY ("NTF_CNV_ID") REFERENCES "CONVENIADOS" ("CNV_ID") ENABLE;
ALTER TABLE "PAGAMENTOS"
ADD CONSTRAINT "FK_PGT_MNL" FOREIGN KEY ("PGT_MNL_ID") REFERENCES "MENSALISTAS" ("MNL_ID") ENABLE;
ALTER TABLE "VEICULOS"
ADD CONSTRAINT "FK_VCL_MNL" FOREIGN KEY ("VCL_MNL_ID") REFERENCES "MENSALISTAS" ("MNL_ID") ENABLE;
ALTER TABLE "VEICULOS"
ADD CONSTRAINT "FK_VCL_TPV" FOREIGN KEY ("VCL_TPV_ID") REFERENCES "TIPOS_VAGAS" ("TPV_ID") ENABLE;
----------------------------------------------
-- FIM - RESTRICOES RELACOES
----------------------------------------------
-------------------------------------------
-- TRIGGERS
-------------------------------------------
-- TRIGGERS - CONVENIADOS
CREATE OR REPLACE NONEDITIONABLE TRIGGER "CNV_TRG" BEFORE
INSERT ON "CONVENIADOS" FOR EACH ROW BEGIN :new.CNV_ID := CNV_SEQ.nextval;
END;
/ ALTER TRIGGER "CNV_TRG" ENABLE;
-- TRIGGERS - CUSTOS ESTACIONAMENTO
CREATE OR REPLACE NONEDITIONABLE TRIGGER "CES_TRG" BEFORE
INSERT ON "CUSTOS_ESTACIONAMENTO" FOR EACH ROW BEGIN :new.CES_ID := CES_SEQ.nextval;
END;
/ ALTER TRIGGER "CES_TRG" ENABLE;
-- TRIGGERS - MENSALISTAS
CREATE OR REPLACE NONEDITIONABLE TRIGGER "MNL_TRG" BEFORE
INSERT ON "MENSALISTAS" FOR EACH ROW BEGIN :new.MNL_ID := MNL_SEQ.nextval;
END;
/ ALTER TRIGGER "MNL_TRG" ENABLE;
-- TRIGGERS - NOTAS FISCAIS
CREATE OR REPLACE NONEDITIONABLE TRIGGER "NTF_TRG" BEFORE
INSERT ON "NOTAS_FISCAIS" FOR EACH ROW BEGIN :new.NTF_ID := NTF_SEQ.nextval;
END;
/ ALTER TRIGGER "NTF_TRG" ENABLE;
-- TRIGGERS - PAGAMENTOS
CREATE OR REPLACE NONEDITIONABLE TRIGGER "PGT_TRG" BEFORE
INSERT ON "PAGAMENTOS" FOR EACH ROW BEGIN :new.PGT_ID := PGT_SEQ.nextval;
END;
/ ALTER TRIGGER "PGT_TRG" ENABLE;
-- TRIGGERS - TIPOS VAGAS
CREATE OR REPLACE NONEDITIONABLE TRIGGER "TPV_TRG" BEFORE
INSERT ON "PAGAMENTOS" FOR EACH ROW BEGIN :new.PTV_ID := TPV_SEQ.nextval;
END;
/ ALTER TRIGGER "TPV_TRG" ENABLE;
-- TRIGGERS - VEICULOS
CREATE OR REPLACE NONEDITIONABLE TRIGGER "VCL_TRG" BEFORE
INSERT ON "VEICULOS" FOR EACH ROW BEGIN :new.VCL_ID := VCL_SEQ.nextval;
END;
/ ALTER TRIGGER "VCL_TRG" ENABLE;
-------------------------------------------
-- FIM - TRIGGERS
-------------------------------------------